[
  {
    "Id": "797388",
    "ThreadId": "343171",
    "Html": "<p>I'm having an issue with an SVG linear gradient I want to export to PNG/JPG format.</p>\n<p>Workflow:</p>\n<p>I have an xml/svg file.</p>\n<p>&nbsp;</p>\n<div style=\"color: black; background-color: white;\">\n<pre><span style=\"color: blue;\">&lt;</span><span style=\"color: #a31515;\">svg</span> <span style=\"color: red;\">xmlns</span><span style=\"color: blue;\">=</span><span style=\"color: black;\">\"</span><span style=\"color: blue;\">http://www.w3.org/2000/svg</span><span style=\"color: black;\">\"</span> <span style=\"color: red;\">width</span><span style=\"color: blue;\">=</span><span style=\"color: black;\">\"</span><span style=\"color: blue;\">280</span><span style=\"color: black;\">\"</span> <span style=\"color: red;\">height</span><span style=\"color: blue;\">=</span><span style=\"color: black;\">\"</span><span style=\"color: blue;\">450</span><span style=\"color: black;\">\"</span> <span style=\"color: red;\">version</span><span style=\"color: blue;\">=</span><span style=\"color: black;\">\"</span><span style=\"color: blue;\">1.1</span><span style=\"color: black;\">\"</span><span style=\"color: blue;\">&gt;</span>\n  <span style=\"color: blue;\">&lt;</span><span style=\"color: #a31515;\">g</span> <span style=\"color: red;\">transform</span><span style=\"color: blue;\">=</span><span style=\"color: black;\">\"</span><span style=\"color: blue;\">scale(1, 1)</span><span style=\"color: black;\">\"</span><span style=\"color: black;\"><span style=\"color: #0000ff;\">&gt;</span></span>\n    <span style=\"color: blue;\">&lt;</span><span style=\"color: #a31515;\">rect</span> <span style=\"color: red;\">id</span><span style=\"color: blue;\">=</span><span style=\"color: black;\">\"</span><span style=\"color: blue;\">schuldgraad2008</span><span style=\"color: black;\">\"</span> <span style=\"color: red;\">x</span><span style=\"color: blue;\">=</span><span style=\"color: black;\">\"</span><span style=\"color: blue;\">117</span><span style=\"color: black;\">\"</span> <span style=\"color: red;\">y</span><span style=\"color: blue;\">=</span><span style=\"color: black;\">\"</span><span style=\"color: blue;\">120</span><span style=\"color: black;\">\"</span> <span style=\"color: red;\">width</span><span style=\"color: blue;\">=</span><span style=\"color: black;\">\"</span><span style=\"color: blue;\">16</span><span style=\"color: black;\">\"</span> <span style=\"color: red;\">height</span><span style=\"color: blue;\">=</span><span style=\"color: black;\">\"</span><span style=\"color: blue;\">350</span><span style=\"color: black;\">\"</span> <span style=\"color: red;\">fill</span><span style=\"color: blue;\">=</span><span style=\"color: black;\">\"</span><span style=\"color: blue;\">url(#schuldgradient)</span><span style=\"color: black;\">\"</span> <span style=\"color: red;\">stroke</span><span style=\"color: blue;\">=</span><span style=\"color: black;\">\"</span><span style=\"color: blue;\">none</span><span style=\"color: black;\">\"</span> <span style=\"color: red;\">stroke-width</span><span style=\"color: blue;\">=</span><span style=\"color: black;\">\"</span><span style=\"color: blue;\">0\"</span><span style=\"color: blue;\">/&gt;</span>\n  <span style=\"color: blue;\">&lt;/</span><span style=\"color: #a31515;\">g</span><span style=\"color: blue;\">&gt;</span>\n  <span style=\"color: blue;\">&lt;</span><span style=\"color: #a31515;\">defs</span><span style=\"color: blue;\">&gt;</span>\n    <span style=\"color: blue;\">&lt;</span><span style=\"color: #a31515;\">linearGradient</span> <span style=\"color: red;\">id</span><span style=\"color: blue;\">=</span><span style=\"color: black;\">\"</span><span style=\"color: blue;\">schuldgradient</span><span style=\"color: black;\">\"</span> <span style=\"color: red;\">x1</span><span style=\"color: blue;\">=</span><span style=\"color: black;\">\"</span><span style=\"color: blue;\">0%</span><span style=\"color: black;\">\"</span> <span style=\"color: red;\">y1</span><span style=\"color: blue;\">=</span><span style=\"color: black;\">\"</span><span style=\"color: blue;\">0%</span><span style=\"color: black;\">\"</span> <span style=\"color: red;\">x2</span><span style=\"color: blue;\">=</span><span style=\"color: black;\">\"</span><span style=\"color: blue;\">0%</span><span style=\"color: black;\">\"</span> <span style=\"color: red;\">y2</span><span style=\"color: blue;\">=</span><span style=\"color: black;\">\"</span><span style=\"color: blue;\">100%</span><span style=\"color: black;\">\"</span><span style=\"color: blue;\">&gt;</span>\n      <span style=\"color: blue;\">&lt;</span><span style=\"color: #a31515;\">stop</span> <span style=\"color: red;\">offset</span><span style=\"color: blue;\">=</span><span style=\"color: black;\">\"</span><span style=\"color: blue;\">24.9494759131441%</span><span style=\"color: black;\">\"</span> <span style=\"color: red;\">style</span><span style=\"color: blue;\">=</span><span style=\"color: black;\">\"</span><span style=\"color: blue;\">stop-color:#39AE4A;stop-opacity:1</span><span style=\"color: black;\">\"</span><span style=\"color: blue;\">/&gt;</span>\n      <span style=\"color: blue;\">&lt;</span><span style=\"color: #a31515;\">stop</span> <span style=\"color: red;\">offset</span><span style=\"color: blue;\">=</span><span style=\"color: black;\">\"</span><span style=\"color: blue;\">27.890811531758%</span><span style=\"color: black;\">\"</span> <span style=\"color: red;\">style</span><span style=\"color: blue;\">=</span><span style=\"color: black;\">\"</span><span style=\"color: blue;\">stop-color:#CE2429;stop-opacity:1</span><span style=\"color: black;\">\"</span><span style=\"color: blue;\">/&gt;</span>\n    <span style=\"color: blue;\">&lt;/</span><span style=\"color: #a31515;\">linearGradient</span><span style=\"color: blue;\">&gt;</span>\n  <span style=\"color: blue;\">&lt;/</span><span style=\"color: #a31515;\">defs</span><span style=\"color: blue;\">&gt;</span>\n<span style=\"color: blue;\">&lt;/</span><span style=\"color: #a31515;\">svg</span><span style=\"color: blue;\">&gt;</span>\n</pre>\n</div>\n<p>&nbsp;</p>\n<p>This renders nicely in firefox, chrome, ...</p>\n<p>For older IE browsers and other applications I want to export this to PNG and JPG, that's where the SVG Rendering Engine comes in play.</p>\n<p>&nbsp;</p>\n<div style=\"color: black; background-color: white;\">\n<pre><span style=\"color: blue;\">Dim</span> newStream <span style=\"color: blue;\">As</span> <span style=\"color: blue;\">New</span> System.IO.MemoryStream(ASCIIEncoding.<span style=\"color: blue;\">Default</span>.GetBytes(newDom.InnerXml))\n<span style=\"color: blue;\">Dim</span> testSVG <span style=\"color: blue;\">As</span> Svg.SvgDocument = Svg.SvgDocument.Open(newStream, <span style=\"color: blue;\">Nothing</span>)</pre>\n<pre><span style=\"color: blue;\">Dim</span> tempStream <span style=\"color: blue;\">As</span> <span style=\"color: blue;\">New</span> System.IO.MemoryStream()\ntestSVG.Draw().Save(tempStream, System.Drawing.Imaging.ImageFormat.Png)</pre>\n<pre><span style=\"color: blue;\">Dim</span> img <span style=\"color: blue;\">As</span> System.Drawing.Image\nimg = System.Drawing.Image.FromStream(tempStream)\nimg.Save(tempStream, System.Drawing.Imaging.ImageFormat.Png)\nContext.Response.ContentType = <span style=\"color: #a31515;\">\"image/png\"</span>\nContext.Response.BinaryWrite(tempStream.ToArray)\n</pre>\n</div>\n<p>&nbsp;</p>\n<p>This works fine for rectangels, text, lines, polylines, ... Gradients in the definitionlist he does not recognize when importing, a black rectangle gets displayed. I constructed a function to fix this issue. And for testing purposes I cleared the gradient stops and added 3 new ones.</p>\n<p>&nbsp;</p>\n<div style=\"color: black; background-color: white;\">\n<pre><span style=\"color: blue;\">Dim</span> myGradient <span style=\"color: blue;\">As</span> Svg.SvgLinearGradientServer = <span style=\"color: blue;\">CType</span>(mySvg.GetElementById(gradientId), Svg.SvgLinearGradientServer)\nmyGradient.Children.Clear()\nmyGradient.Stops.Clear()\nmyGradient.Stops.Add(<span style=\"color: blue;\">New</span> Svg.SvgGradientStop(<span style=\"color: blue;\">New</span> Svg.SvgUnit(Svg.SvgUnitType.Percentage, 0), Drawing.Color.DarkCyan))\nmyGradient.Stops.Add(<span style=\"color: blue;\">New</span> Svg.SvgGradientStop(<span style=\"color: blue;\">New</span> Svg.SvgUnit(Svg.SvgUnitType.Percentage, 50), Drawing.Color.Aqua))\nmyGradient.Stops.Add(<span style=\"color: blue;\">New</span> Svg.SvgGradientStop(<span style=\"color: blue;\">New</span> Svg.SvgUnit(Svg.SvgUnitType.Percentage, 100.0), Drawing.Color.Red))\n\n<span style=\"color: blue;\">CType</span>(mySvg.GetElementById(element.Attributes(<span style=\"color: #a31515;\">\"id\"</span>).Value), Svg.SvgRectangle).Fill = myGradient</pre>\n<pre><br /></pre>\n<pre><br /></pre>\n<p>This works fine except for the fact that my gradient is not in the right position.&nbsp; My gradient starts with DarkCyan at 0px, reaches Aqua at +-120px and reaches RED at +-240px. After It reaches Red the gradient starts all over again in the opposite direction. This leaves me with +-110 pixels that did not receive the right gradient. The Gradient thinks that those 240px is 100%. That's false, 350 is 100%. I uploaded a pic to illustrate my problem</p>\n<img src=\"http://i128.photobucket.com/albums/p184/stijnzer/PNGGRADIENT.png\" alt=\"\" />\n<p>extra information:<br />-GradientUnits is set at BoundingBox<br />-SpreadMethod is set at Pad <br />I played around with all kinds of properties but none solved the problem.</p>\n<pre><span style=\"background-color: white;\">Is this a bug?</span></pre>\n</div>",
    "PostedDate": "2012-02-23T04:20:53.817-08:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "797682",
    "ThreadId": "343171",
    "Html": "<p>I played around a bit more and found this strange behaviour</p>\n<p>This is the svg rectangle I worked with</p>\n<pre><span style=\"color: blue;\">&lt;</span><span style=\"color: #a31515;\">rect</span> <span style=\"color: red;\">id</span><span style=\"color: blue;\">=</span><span style=\"color: black;\">\"</span><span style=\"color: blue;\">schuldgraad2008</span><span style=\"color: black;\">\"</span> <span style=\"color: red;\">x</span><span style=\"color: blue;\">=</span><span style=\"color: black;\">\"</span><span style=\"color: blue;\">117</span><span style=\"color: black;\">\"</span> <span style=\"color: red;\">y</span><span style=\"color: blue;\">=</span><span style=\"color: black;\">\"</span><span style=\"color: blue;\">120</span><span style=\"color: black;\">\"</span> <span style=\"color: red;\">width</span><span style=\"color: blue;\">=</span><span style=\"color: black;\">\"</span><span style=\"color: blue;\">16</span><span style=\"color: black;\">\"</span> <span style=\"color: red;\">height</span><span style=\"color: blue;\">=</span><span style=\"color: black;\">\"</span><span style=\"color: blue;\">350</span><span style=\"color: black;\">\"</span> <span style=\"color: red;\">fill</span><span style=\"color: blue;\">=</span><span style=\"color: black;\">\"</span><span style=\"color: blue;\">url(#schuldgradient)</span><span style=\"color: black;\">\"</span> <span style=\"color: red;\">stroke</span><span style=\"color: blue;\">=</span><span style=\"color: black;\">\"</span><span style=\"color: blue;\">none</span><span style=\"color: black;\">\"</span> <span style=\"color: red;\">stroke-width</span><span style=\"color: blue;\">=</span><span style=\"color: black;\">\"</span><span style=\"color: blue;\">0</span><span style=\"color: black;\">\"</span><span style=\"color: blue;\">/&gt;</span></pre>\n<p>this is a screenshot of what it should look like (svg screenshot)</p>\n<p><img src=\"http://i128.photobucket.com/albums/p184/stijnzer/SVGGradientScreenshot.png\" alt=\"\" /></p>\n<p>This is the png conversion</p>\n<p><img src=\"http://i128.photobucket.com/albums/p184/stijnzer/PNGGradient120.png\" alt=\"\" /></p>\n<p>&nbsp;</p>\n<p>And now the strange behaviour, if I change the Y value to 3 this is the PNG output</p>\n<pre><span style=\"color: blue;\">&lt;</span><span style=\"color: #a31515;\">rect</span> <span style=\"color: red;\">id</span><span style=\"color: blue;\">=</span><span style=\"color: black;\">\"</span><span style=\"color: blue;\">schuldgraad2008</span><span style=\"color: black;\">\"</span> <span style=\"color: red;\">x</span><span style=\"color: blue;\">=</span><span style=\"color: black;\">\"</span><span style=\"color: blue;\">117</span><span style=\"color: black;\">\"</span> <span style=\"color: red;\">y</span><span style=\"color: blue;\">=</span><span style=\"color: black;\">\"</span><span style=\"color: blue;\">3</span><span style=\"color: black;\">\"</span> <span style=\"color: red;\">width</span><span style=\"color: blue;\">=</span><span style=\"color: black;\">\"</span><span style=\"color: blue;\">16</span><span style=\"color: black;\">\"</span> <span style=\"color: red;\">height</span><span style=\"color: blue;\">=</span><span style=\"color: black;\">\"</span><span style=\"color: blue;\">350</span><span style=\"color: black;\">\"</span> <span style=\"color: red;\">fill</span><span style=\"color: blue;\">=</span><span style=\"color: black;\">\"</span><span style=\"color: blue;\">url(#schuldgradient)</span><span style=\"color: black;\">\"</span> <span style=\"color: red;\">stroke</span><span style=\"color: blue;\">=</span><span style=\"color: black;\">\"</span><span style=\"color: blue;\">none</span><span style=\"color: black;\">\"</span> <span style=\"color: red;\">stroke-width</span><span style=\"color: blue;\">=</span><span style=\"color: black;\">\"</span><span style=\"color: blue;\">0</span><span style=\"color: black;\">\"</span><span style=\"color: blue;\">/&gt;<br /><br /></span></pre>\n<p><img src=\"http://i128.photobucket.com/albums/p184/stijnzer/PNGGRADIENT1.png\" alt=\"\" /></p>\n<p>&nbsp;</p>\n<p>Keep in mind that the gradient definition never changed, only the Y value in the rectangle. This looks to me as if a variable gets assigned wrong or something like that...</p>\n<p>Also if Y equals width in the rectangle, the gradient is correct, but that doesn't make any sense since I dont want my rectangle 350 pixels from the top.</p>\n<p>Is it possible to receive the source code and let me debug it and find out what is wrong?</p>",
    "PostedDate": "2012-02-23T07:10:36.917-08:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  }
]